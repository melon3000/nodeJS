<%- include('partials/header') %>

<h1 class="h3 mb-3">Admin panel</h1>


<%
  function nextDir(col) {
    if (sort === col) return dir === 'asc' ? 'desc' : 'asc';
    return 'asc';
  }
%>

<table class="table table-striped table-bordered align-middle">
  <thead>
    <tr>
      <th>
        <a href="/admin?sort=username&dir=<%= nextDir('username') %>">User</a>
      </th>
      <th>
        <a href="/admin?sort=title&dir=<%= nextDir('title') %>">Title</a>
      </th>
      <th>
        <a href="/admin?sort=content&dir=<%= nextDir('content') %>">Content</a>
      </th>
      <th>
        <a href="/admin?sort=created_at&dir=<%= nextDir('created_at') %>">Date</a>
      </th>
      <th style="width: 210px;">Actions</th>
    </tr>
  </thead>

  <tbody>
    <% rows.forEach(r => { %>
      <tr>
        <td><%= r.username ? r.username : 'Unknown' %></td>
        <td><a href="/news/<%= r.id %>"><%= r.title %></a></td>
        <td><%= r.content.length > 120 ? (r.content.substring(0, 120) + '...') : r.content %></td>
        <td><%= new Date(r.created_at).toLocaleString('et-EE') %></td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="/news/<%= r.id %>/edit">Muuda</a>

          <form action="/news/delete" method="POST" class="d-inline"
                onsubmit="return confirm('Kustuta uudis?');">
            <input type="hidden" name="id" value="<%= r.id %>">
            <button class="btn btn-sm btn-danger" type="submit">Kustuta</button>
          </form>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>



<%- include('partials/footer') %>
